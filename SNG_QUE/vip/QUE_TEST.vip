/*************************************************************************************************\

* Наименование: Ведение телефонного справочника                                                   *
* Контур/Модуль: абстракция интеграция                                                            *
* Примечание: Интерфейс ручного запуска методов работы с очередью                                 *
*                                                                                                 *
* Вид работы  |Номер         |Дата    |Исполнитель              |Проект                           *
* ----------------------------------------------------------------------------------------------- *

\*************************************************************************************************/


#include QUE_BASE.vih

//************************************************************
const
end;

VipInterface QUE_TEST #Licensed_Free;

Interface QUE_TEST 'Работа с очередью. ТЕСТОВЫЙ ИНТЕРФЕЙС', CYAN;

create view
 var
     _fQRY_INST_CODE
   , _AddWhereString
   , _strParameter   : string;
     _RootTableNrec  : comp;
;
  Screen ScrQRY_INSTANCE_TEST (,,Sci1Esc);
  Show at (,,,);
    noTableNavigation;
  Fields
    _fQRY_INST_CODE : NoProtect;
    _RootTableNrec  : NoProtect;
    _AddWhereString : NoProtect;
  buttons
   cmValue1,,,;
   cmValue2,,,;
   cmValue3,,,;
   cmValue4,,,;
   cmValue5,,,;
<<
Демонстрация работы  объекта по вставке записей на рассмотрение и генерации JSON
Записи на рассмотрение это "предочередь" - по ним идут проверки, пишутся логи и генерируются JSON

      Код экземпляра запроса.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
  `- NREC  корневой таблицы`.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
  `-   доп.условия в запрос`.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
     (NREC имеет приоритет над доп.условиями в запрос)

  <.    Создать запись на рассмотрение генерации JSON    .> - создание одиночной записи

  <.  Создать пул записей на рассмотрение генерации JSON .> - тройной вложенный цикл по 4 шага каждый генерирует подчиненные записи по одному экземпляру
--------------------------------------------------
  <.    Сгенерировать JSON по записям на рассмотрении    .> - выбирается пул записей без родителей (100шт)

  <.           Передать записи с JSON в очередь          .> * записи с готовыми JSON копируются в очередь

  <.          Открыть записи на рассмотрении             .> - интерфейс просмотра "записей на рассмотрении"

>>
  end;//Screen ScrQRY_getParameter


handleevent // фейса
 cmValue1: {
   var iQUE_BASE : QUE_BASE;
   if iQUE_BASE.InsertEntriesForReview_Single(  coQUE_TypeEvent_Insert
                                           , _fQRY_INST_CODE
                                           , _AddWhereString
                                           , _RootTableNrec) <> 0h
                                           {
        message('Готово')
      }
      else {
        message('Ошибка добавления записи в QUE_EntriesForReview', error)
      }
 }
 cmValue2: {
     var _cMainParent : comp;
     var iQUE_BASE : QUE_BASE;
     _cMainParent := iQUE_BASE.InsertEntriesForReview_PoolParent(0h, coQUE_TypeEvent_Insert, _fQRY_INST_CODE, _AddWhereString, _RootTableNrec);
     if _cMainParent = 0h {
       message('Ошибка добавления записи в QUE_EntriesForReview', error);
       stop; abort; exit;
     }
     var _i, _j, _k: byte;
     var _cSubParent, _cSubSubParent : comp = 0h;
     for(_i:= 0; _i<=3; _i++) {
       _cSubParent := iQUE_BASE.InsertEntriesForReview_PoolParent(_cMainParent, coQUE_TypeEvent_Insert, _fQRY_INST_CODE, _AddWhereString, _RootTableNrec);
       for(_j:= 0; _j<=3; _j++) {
         _cSubSubParent := iQUE_BASE.InsertEntriesForReview_PoolParent(_cSubParent, coQUE_TypeEvent_Insert, _fQRY_INST_CODE, _AddWhereString, _RootTableNrec);
         for(_k:= 0; _k<=3; _k++) {
           iQUE_BASE.InsertEntriesForReview_PoolParent(_cSubSubParent, coQUE_TypeEvent_Insert, _fQRY_INST_CODE, _AddWhereString, _RootTableNrec);
         }
       }
     }
     iQUE_BASE.SetPoolRecordsReadyToGenerateJSON(_cMainParent);
     message('Готово')
   }
 cmValue3: {
   var iQUE_BASE : QUE_BASE;
   StartNewVisual(vtRotateVisual, vfTimer + vfBreak, 'Генерация JSON', 1);
    iQUE_BASE.ProcessEntriesForReview;
   StopVisual('', 0);
     message('Готово')
 }
 cmValue4: {
   var iQUE_BASE : QUE_BASE;
   StartNewVisual(vtRotateVisual, vfTimer + vfBreak, 'Копирование в очередь', 1);
    iQUE_BASE.CopyEntriesForReviewToQueue;;
   StopVisual('', 0);
     message('Готово')
}
 cmValue5: {
   runinterface(SNG_QUE::QUE_View_QUE_EntriesForReview);
 }
end;
end.
