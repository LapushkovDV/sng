/*************************************************************************************************\

* Наименование: Ведение телефонного справочника                                                   *
* Контур/Модуль: абстракция интеграция                                                            *
* Примечание:                                                                                     *
*                                                                                                 *
* Вид работы  |Номер         |Дата    |Исполнитель              |Проект                           *
* ----------------------------------------------------------------------------------------------- *

\*************************************************************************************************/

#include QRY_INSTANCE.vih
#include QRY_OUT.vih
//************************************************************
const
end;
Interface QRY_INSTANCE 'Экземпляры запросов. Просмотр/редактирование', CYAN;

create view
var  ShowpanInstWithOutTmplt : byte;
;


#include QRY_INSTANCE.pan

handleevent // фейса
cmCheckField: {
   case curfield of
    #ShowpanInstWithOutTmplt: {
       if ShowpanInstWithOutTmplt = 0
        then setformat(panInstWithOutTmplt)
        else setformat(panInstWithTmplt)
   }
  end;
 updatetable;
 rereadrecord;
}
cmPick:{
  case curfield of
     #QRY_INST_TMPLT.CODE :{
        set QRY_INST.cTmplt := GetTemplate;
        updatetable;
       }
     #QRY_INST_FLD.FieldName :{
        filltFields;
        if runwindowmodal(wintFields) = cmDefault {
          set QRY_INST_FLD.TABLECODE := tFields.tableCode;
          set QRY_INST_FLD.TableName := tFields.NAMETBL;
          set QRY_INST_FLD.FieldName := tFields.NAMETBL + '.'+tFields.NAME;
          updatetable;
         }
     }
     #QRY_INST_FLD_LVL_FLD.level
    ,#QRY_INST_FLD_LVL_FLD.fld_json_name: {
       if runwindowmodal(winSelQRY_INST_FLD_LVL) = cmDefault {
         set QRY_INST_FLD.cLevel := QRY_INST_FLD_LVL.nrec;
         updatetable;
       }
     }
  end;
  rereadrecord;
}

cmInit:{
 if getfirst QRY_TMPLT = tsOK {}
 // HttpConnect_JsonObjectCreate
}
cmEdit: {
  putcommand(cmdefault)
}

cmdefault:{
  runwindowmodal(wnQRY_INSTANCE_Edit);
  rereadrecord;
}
end;
end.
